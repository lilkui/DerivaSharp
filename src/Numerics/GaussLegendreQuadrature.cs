using System.Collections.Frozen;

namespace DerivaSharp.Numerics;

/// <summary>
///     Gauss-Legendre quadrature for approximating definite integrals.
/// </summary>
public static class GaussLegendreQuadrature
{
    private static readonly FrozenDictionary<int, Point> s_precomputedPoints = new Dictionary<int, Point>
    {
        // Even
        {
            2, new Point(
                2,
                [0.5773502691896257645091488],
                [1.0000000000000000000000000])
        },
        {
            4, new Point(
                4,
                [0.3399810435848562648026658, 0.8611363115940525752239465],
                [0.6521451548625461426269361, 0.3478548451374538573730639])
        },
        {
            6, new Point(
                6,
                [0.2386191860831969086305017, 0.6612093864662645136613996, 0.9324695142031520278123016],
                [0.4679139345726910473898703, 0.3607615730481386075698335, 0.1713244923791703450402961])
        },
        {
            8, new Point(
                8,
                [0.1834346424956498049394761, 0.5255324099163289858177390, 0.7966664774136267395915539, 0.9602898564975362316835609],
                [0.3626837833783619829651504, 0.3137066458778872873379622, 0.2223810344533744705443560, 0.1012285362903762591525314])
        },
        {
            10, new Point(
                10,
                [0.1488743389816312108848260, 0.4333953941292471907992659, 0.6794095682990244062343274, 0.8650633666889845107320967, 0.9739065285171717200779640],
                [0.2955242247147528701738930, 0.2692667193099963550912269, 0.2190863625159820439955349, 0.1494513491505805931457763, 0.0666713443086881375935688])
        },
        {
            12, new Point(
                12,
                [
                    0.1252334085114689154724414,
                    0.3678314989981801937526915,
                    0.5873179542866174472967024,
                    0.7699026741943046870368938,
                    0.9041172563704748566784659,
                    0.9815606342467192506905491,
                ],
                [
                    0.2491470458134027850005624,
                    0.2334925365383548087608499,
                    0.2031674267230659217490645,
                    0.1600783285433462263346525,
                    0.1069393259953184309602547,
                    0.0471753363865118271946160,
                ])
        },
        {
            14, new Point(
                14,
                [
                    0.1080549487073436620662447,
                    0.3191123689278897604356718,
                    0.5152486363581540919652907,
                    0.6872929048116854701480198,
                    0.8272013150697649931897947,
                    0.9284348836635735173363911,
                    0.9862838086968123388415973,
                ],
                [
                    0.2152638534631577901958764,
                    0.2051984637212956039659241,
                    0.1855383974779378137417166,
                    0.1572031671581935345696019,
                    0.1215185706879031846894148,
                    0.0801580871597602098056333,
                    0.0351194603317518630318329,
                ])
        },
        {
            16, new Point(
                16,
                [
                    0.0950125098376374401853193,
                    0.2816035507792589132304605,
                    0.4580167776572273863424194,
                    0.6178762444026437484466718,
                    0.7554044083550030338951012,
                    0.8656312023878317438804679,
                    0.9445750230732325760779884,
                    0.9894009349916499325961542,
                ],
                [
                    0.1894506104550684962853967,
                    0.1826034150449235888667637,
                    0.1691565193950025381893121,
                    0.1495959888165767320815017,
                    0.1246289712555338720524763,
                    0.0951585116824927848099251,
                    0.0622535239386478928628438,
                    0.0271524594117540948517806,
                ])
        },
        {
            18, new Point(
                18,
                [
                    0.0847750130417353012422619,
                    0.2518862256915055095889729,
                    0.4117511614628426460359318,
                    0.5597708310739475346078715,
                    0.6916870430603532078748911,
                    0.8037049589725231156824175,
                    0.8926024664975557392060606,
                    0.9558239495713977551811959,
                    0.9915651684209309467300160,
                ],
                [
                    0.1691423829631435918406565,
                    0.1642764837458327229860538,
                    0.1546846751262652449254180,
                    0.1406429146706506512047313,
                    0.1225552067114784601845191,
                    0.1009420441062871655628140,
                    0.0764257302548890565291297,
                    0.0497145488949697964533349,
                    0.0216160135264833103133427,
                ])
        },
        {
            20, new Point(
                20,
                [
                    0.0765265211334973337546404,
                    0.2277858511416450780804962,
                    0.3737060887154195606725482,
                    0.5108670019508270980043641,
                    0.6360536807265150254528367,
                    0.7463319064601507926143051,
                    0.8391169718222188233945291,
                    0.9122344282513259058677524,
                    0.9639719272779137912676661,
                    0.9931285991850949247861224,
                ],
                [
                    0.1527533871307258506980843,
                    0.1491729864726037467878287,
                    0.1420961093183820513292983,
                    0.1316886384491766268984945,
                    0.1181945319615184173123774,
                    0.1019301198172404350367501,
                    0.0832767415767047487247581,
                    0.0626720483341090635695065,
                    0.0406014298003869413310400,
                    0.0176140071391521183118620,
                ])
        },
        {
            32, new Point(
                32,
                [
                    0.0483076656877383162348126,
                    0.1444719615827964934851864,
                    0.2392873622521370745446032,
                    0.3318686022821276497799168,
                    0.4213512761306353453641194,
                    0.5068999089322293900237475,
                    0.5877157572407623290407455,
                    0.6630442669302152009751152,
                    0.7321821187402896803874267,
                    0.7944837959679424069630973,
                    0.8493676137325699701336930,
                    0.8963211557660521239653072,
                    0.9349060759377396891709191,
                    0.9647622555875064307738119,
                    0.9856115115452683354001750,
                    0.9972638618494815635449811,
                ],
                [
                    0.0965400885147278005667648,
                    0.0956387200792748594190820,
                    0.0938443990808045656391802,
                    0.0911738786957638847128686,
                    0.0876520930044038111427715,
                    0.0833119242269467552221991,
                    0.0781938957870703064717409,
                    0.0723457941088485062253994,
                    0.0658222227763618468376501,
                    0.0586840934785355471452836,
                    0.0509980592623761761961632,
                    0.0428358980222266806568786,
                    0.0342738629130214331026877,
                    0.0253920653092620594557526,
                    0.0162743947309056706051706,
                    0.0070186100094700966004071,
                ])
        },
        {
            64, new Point(
                64,
                [
                    0.0243502926634244325089558,
                    0.0729931217877990394495429,
                    0.1214628192961205544703765,
                    0.1696444204239928180373136,
                    0.2174236437400070841496487,
                    0.2646871622087674163739642,
                    0.3113228719902109561575127,
                    0.3572201583376681159504426,
                    0.4022701579639916036957668,
                    0.4463660172534640879849477,
                    0.4894031457070529574785263,
                    0.5312794640198945456580139,
                    0.5718956462026340342838781,
                    0.6111553551723932502488530,
                    0.6489654712546573398577612,
                    0.6852363130542332425635584,
                    0.7198818501716108268489402,
                    0.7528199072605318966118638,
                    0.7839723589433414076102205,
                    0.8132653151227975597419233,
                    0.8406292962525803627516915,
                    0.8659993981540928197607834,
                    0.8893154459951141058534040,
                    0.9105221370785028057563807,
                    0.9295691721319395758214902,
                    0.9464113748584028160624815,
                    0.9610087996520537189186141,
                    0.9733268277899109637418535,
                    0.9833362538846259569312993,
                    0.9910133714767443207393824,
                    0.9963401167719552793469245,
                    0.9993050417357721394569056,
                ],
                [
                    0.0486909570091397203833654,
                    0.0485754674415034269347991,
                    0.0483447622348029571697695,
                    0.0479993885964583077281262,
                    0.0475401657148303086622822,
                    0.0469681828162100173253263,
                    0.0462847965813144172959532,
                    0.0454916279274181444797710,
                    0.0445905581637565630601347,
                    0.0435837245293234533768279,
                    0.0424735151236535890073398,
                    0.0412625632426235286101563,
                    0.0399537411327203413866569,
                    0.0385501531786156291289625,
                    0.0370551285402400460404151,
                    0.0354722132568823838106931,
                    0.0338051618371416093915655,
                    0.0320579283548515535854675,
                    0.0302346570724024788679741,
                    0.0283396726142594832275113,
                    0.0263774697150546586716918,
                    0.0243527025687108733381776,
                    0.0222701738083832541592983,
                    0.0201348231535302093723403,
                    0.0179517157756973430850453,
                    0.0157260304760247193219660,
                    0.0134630478967186425980608,
                    0.0111681394601311288185905,
                    0.0088467598263639477230309,
                    0.0065044579689783628561174,
                    0.0041470332605624676352875,
                    0.0017832807216964329472961,
                ])
        },
        {
            96, new Point(
                96,
                [
                    0.0162767448496029695791346,
                    0.0488129851360497311119582,
                    0.0812974954644255589944713,
                    0.1136958501106659209112081,
                    0.1459737146548969419891073,
                    0.1780968823676186027594026,
                    0.2100313104605672036028472,
                    0.2417431561638400123279319,
                    0.2731988125910491414872722,
                    0.3043649443544963530239298,
                    0.3352085228926254226163256,
                    0.3656968614723136350308956,
                    0.3957976498289086032850002,
                    0.4254789884073005453648192,
                    0.4547094221677430086356761,
                    0.4834579739205963597684056,
                    0.5116941771546676735855097,
                    0.5393881083243574362268026,
                    0.5665104185613971684042502,
                    0.5930323647775720806835558,
                    0.6189258401254685703863693,
                    0.6441634037849671067984124,
                    0.6687183100439161539525572,
                    0.6925645366421715613442458,
                    0.7156768123489676262251441,
                    0.7380306437444001328511657,
                    0.7596023411766474987029704,
                    0.7803690438674332176036045,
                    0.8003087441391408172287961,
                    0.8194003107379316755389996,
                    0.8376235112281871214943028,
                    0.8549590334346014554627870,
                    0.8713885059092965028737748,
                    0.8868945174024204160568774,
                    0.9014606353158523413192327,
                    0.9150714231208980742058845,
                    0.9277124567223086909646905,
                    0.9393703397527552169318574,
                    0.9500327177844376357560989,
                    0.9596882914487425393000680,
                    0.9683268284632642121736594,
                    0.9759391745851364664526010,
                    0.9825172635630146774470458,
                    0.9880541263296237994807628,
                    0.9925439003237626245718923,
                    0.9959818429872092906503991,
                    0.9983643758631816777241494,
                    0.9996895038832307668276901,
                ],
                [
                    0.0325506144923631662419614,
                    0.0325161187138688359872055,
                    0.0324471637140642693640128,
                    0.0323438225685759284287748,
                    0.0322062047940302506686671,
                    0.0320344562319926632181390,
                    0.0318287588944110065347537,
                    0.0315893307707271685580207,
                    0.0313164255968613558127843,
                    0.0310103325863138374232498,
                    0.0306713761236691490142288,
                    0.0302999154208275937940888,
                    0.0298963441363283859843881,
                    0.0294610899581679059704363,
                    0.0289946141505552365426788,
                    0.0284974110650853856455995,
                    0.0279700076168483344398186,
                    0.0274129627260292428234211,
                    0.0268268667255917621980567,
                    0.0262123407356724139134580,
                    0.0255700360053493614987972,
                    0.0249006332224836102883822,
                    0.0242048417923646912822673,
                    0.0234833990859262198422359,
                    0.0227370696583293740013478,
                    0.0219666444387443491947564,
                    0.0211729398921912989876739,
                    0.0203567971543333245952452,
                    0.0195190811401450224100852,
                    0.0186606796274114673851568,
                    0.0177825023160452608376142,
                    0.0168854798642451724504775,
                    0.0159705629025622913806165,
                    0.0150387210269949380058763,
                    0.0140909417723148609158616,
                    0.0131282295669615726370637,
                    0.0121516046710883196351814,
                    0.0111621020998384985912133,
                    0.0101607705350084157575876,
                    0.0091486712307833866325846,
                    0.0081268769256987592173824,
                    0.0070964707911538652691442,
                    0.0060585455042359616833167,
                    0.0050142027429275176924702,
                    0.0039645543384446866737334,
                    0.0029107318179349464084106,
                    0.0018539607889469217323359,
                    0.0007967920655520124294381,
                ])
        },
        {
            100, new Point(
                100,
                [
                    0.0156289844215430828722167,
                    0.0468716824215916316149239,
                    0.0780685828134366366948174,
                    0.1091892035800611150034260,
                    0.1402031372361139732075146,
                    0.1710800805386032748875324,
                    0.2017898640957359972360489,
                    0.2323024818449739696495100,
                    0.2625881203715034791689293,
                    0.2926171880384719647375559,
                    0.3223603439005291517224766,
                    0.3517885263724217209723438,
                    0.3808729816246299567633625,
                    0.4095852916783015425288684,
                    0.4378974021720315131089780,
                    0.4657816497733580422492166,
                    0.4932107892081909335693088,
                    0.5201580198817630566468157,
                    0.5465970120650941674679943,
                    0.5725019326213811913168704,
                    0.5978474702471787212648065,
                    0.6226088602037077716041908,
                    0.6467619085141292798326303,
                    0.6702830156031410158025870,
                    0.6931491993558019659486479,
                    0.7153381175730564464599671,
                    0.7368280898020207055124277,
                    0.7575981185197071760356680,
                    0.7776279096494954756275514,
                    0.7968978923903144763895729,
                    0.8153892383391762543939888,
                    0.8330838798884008235429158,
                    0.8499645278795912842933626,
                    0.8660146884971646234107400,
                    0.8812186793850184155733168,
                    0.8955616449707269866985210,
                    0.9090295709825296904671263,
                    0.9216092981453339526669513,
                    0.9332885350430795459243337,
                    0.9440558701362559779627747,
                    0.9539007829254917428493369,
                    0.9628136542558155272936593,
                    0.9707857757637063319308979,
                    0.9778093584869182885537811,
                    0.9838775407060570154961002,
                    0.9889843952429917480044187,
                    0.9931249370374434596520099,
                    0.9962951347331251491861317,
                    0.9984919506395958184001634,
                    0.9997137267734412336782285,
                ],
                [
                    0.0312554234538633569476425,
                    0.0312248842548493577323765,
                    0.0311638356962099067838183,
                    0.0310723374275665165878102,
                    0.0309504788504909882340635,
                    0.0307983790311525904277139,
                    0.0306161865839804484964594,
                    0.0304040795264548200165079,
                    0.0301622651051691449190687,
                    0.0298909795933328309168368,
                    0.0295904880599126425117545,
                    0.0292610841106382766201190,
                    0.0289030896011252031348762,
                    0.0285168543223950979909368,
                    0.0281027556591011733176483,
                    0.0276611982207923882942042,
                    0.0271926134465768801364916,
                    0.0266974591835709626603847,
                    0.0261762192395456763423087,
                    0.0256294029102081160756420,
                    0.0250575444815795897037642,
                    0.0244612027079570527199750,
                    0.0238409602659682059625604,
                    0.0231974231852541216224889,
                    0.0225312202563362727017970,
                    0.0218430024162473863139537,
                    0.0211334421125276415426723,
                    0.0204032326462094327668389,
                    0.0196530874944353058653815,
                    0.0188837396133749045529412,
                    0.0180959407221281166643908,
                    0.0172904605683235824393442,
                    0.0164680861761452126431050,
                    0.0156296210775460027239369,
                    0.0147758845274413017688800,
                    0.0139077107037187726879541,
                    0.0130259478929715422855586,
                    0.0121314576629794974077448,
                    0.0112251140231859771172216,
                    0.0103078025748689695857821,
                    0.0093804196536944579514182,
                    0.0084438714696689714026208,
                    0.0074990732554647115788287,
                    0.0065469484508453227641521,
                    0.0055884280038655151572119,
                    0.0046244500634221193510958,
                    0.0036559612013263751823425,
                    0.0026839253715534824194396,
                    0.0017093926535181052395294,
                    0.0007346344905056717304063,
                ])
        },
        {
            128, new Point(
                128,
                [
                    0.0122236989606157641980521,
                    0.0366637909687334933302153,
                    0.0610819696041395681037870,
                    0.0854636405045154986364980,
                    0.1097942311276437466729747,
                    0.1340591994611877851175753,
                    0.1582440427142249339974755,
                    0.1823343059853371824103826,
                    0.2063155909020792171540580,
                    0.2301735642266599864109866,
                    0.2538939664226943208556180,
                    0.2774626201779044028062316,
                    0.3008654388776772026671541,
                    0.3240884350244133751832523,
                    0.3471177285976355084261628,
                    0.3699395553498590266165917,
                    0.3925402750332674427356482,
                    0.4149063795522750154922739,
                    0.4370245010371041629370429,
                    0.4588814198335521954490891,
                    0.4804640724041720258582757,
                    0.5017595591361444642896063,
                    0.5227551520511754784539479,
                    0.5434383024128103634441936,
                    0.5637966482266180839144308,
                    0.5838180216287630895500389,
                    0.6034904561585486242035732,
                    0.6228021939105849107615396,
                    0.6417416925623075571535249,
                    0.6602976322726460521059468,
                    0.6784589224477192593677557,
                    0.6962147083695143323850866,
                    0.7135543776835874133438599,
                    0.7304675667419088064717369,
                    0.7469441667970619811698824,
                    0.7629743300440947227797691,
                    0.7785484755064119668504941,
                    0.7936572947621932902433329,
                    0.8082917575079136601196422,
                    0.8224431169556438424645942,
                    0.8361029150609068471168753,
                    0.8492629875779689691636001,
                    0.8619154689395484605906323,
                    0.8740527969580317986954180,
                    0.8856677173453972174082924,
                    0.8967532880491581843864474,
                    0.9073028834017568139214859,
                    0.9173101980809605370364836,
                    0.9267692508789478433346245,
                    0.9356743882779163757831268,
                    0.9440202878302201821211114,
                    0.9518019613412643862177963,
                    0.9590147578536999280989185,
                    0.9656543664319652686458290,
                    0.9717168187471365809043384,
                    0.9771984914639073871653744,
                    0.9820961084357185360247656,
                    0.9864067427245862088712355,
                    0.9901278184917343833379303,
                    0.9932571129002129353034372,
                    0.9957927585349811868641612,
                    0.9977332486255140198821574,
                    0.9990774599773758950119878,
                    0.9998248879471319144736081,
                ],
                [
                    0.0244461801962625182113259,
                    0.0244315690978500450548486,
                    0.0244023556338495820932980,
                    0.0243585572646906258532685,
                    0.0243002001679718653234426,
                    0.0242273192228152481200933,
                    0.0241399579890192849977167,
                    0.0240381686810240526375873,
                    0.0239220121367034556724504,
                    0.0237915577810034006387807,
                    0.0236468835844476151436514,
                    0.0234880760165359131530253,
                    0.0233152299940627601224157,
                    0.0231284488243870278792979,
                    0.0229278441436868469204110,
                    0.0227135358502364613097126,
                    0.0224856520327449668718246,
                    0.0222443288937997651046291,
                    0.0219897106684604914341221,
                    0.0217219495380520753752610,
                    0.0214412055392084601371119,
                    0.0211476464682213485370195,
                    0.0208414477807511491135839,
                    0.0205227924869600694322850,
                    0.0201918710421300411806732,
                    0.0198488812328308622199444,
                    0.0194940280587066028230219,
                    0.0191275236099509454865185,
                    0.0187495869405447086509195,
                    0.0183604439373313432212893,
                    0.0179603271850086859401969,
                    0.0175494758271177046487069,
                    0.0171281354231113768306810,
                    0.0166965578015892045890915,
                    0.0162550009097851870516575,
                    0.0158037286593993468589656,
                    0.0153430107688651440859909,
                    0.0148731226021473142523855,
                    0.0143943450041668461768239,
                    0.0139069641329519852442880,
                    0.0134112712886163323144890,
                    0.0129075627392673472204428,
                    0.0123961395439509229688217,
                    0.0118773073727402795758911,
                    0.0113513763240804166932817,
                    0.0108186607395030762476596,
                    0.0102794790158321571332153,
                    0.0097341534150068058635483,
                    0.0091830098716608743344787,
                    0.0086263777986167497049788,
                    0.0080645898904860579729286,
                    0.0074979819256347286876720,
                    0.0069268925668988135634267,
                    0.0063516631617071887872143,
                    0.0057726375428656985893346,
                    0.0051901618326763302050708,
                    0.0046045842567029551182905,
                    0.0040162549837386423131943,
                    0.0034255260409102157743378,
                    0.0028327514714579910952857,
                    0.0022382884309626187436221,
                    0.0016425030186690295387909,
                    0.0010458126793403487793129,
                    0.0004493809602920903763943,
                ])
        },

        // Odd
        {
            3, new Point(
                3,
                [0.0000000000000000000000000, 0.7745966692414833770358531],
                [0.8888888888888888888888889, 0.5555555555555555555555556])
        },
        {
            5, new Point(
                5,
                [0.0000000000000000000000000, 0.5384693101056830910363144, 0.9061798459386639927976269],
                [0.5688888888888888888888889, 0.4786286704993664680412915, 0.2369268850561890875142640])
        },
        {
            7, new Point(
                7,
                [0.0000000000000000000000000, 0.4058451513773971669066064, 0.7415311855993944398638648, 0.9491079123427585245261897],
                [0.4179591836734693877551020, 0.3818300505051189449503698, 0.2797053914892766679014678, 0.1294849661688696932706114])
        },
        {
            9, new Point(
                9,
                [0.0000000000000000000000000, 0.3242534234038089290385380, 0.6133714327005903973087020, 0.8360311073266357942994298, 0.9681602395076260898355762],
                [0.3302393550012597631645251, 0.3123470770400028400686304, 0.2606106964029354623187429, 0.1806481606948574040584720, 0.0812743883615744119718922])
        },
        {
            11, new Point(
                11,
                [
                    0.0000000000000000000000000,
                    0.2695431559523449723315320,
                    0.5190961292068118159257257,
                    0.7301520055740493240934163,
                    0.8870625997680952990751578,
                    0.9782286581460569928039380,
                ],
                [
                    0.2729250867779006307144835,
                    0.2628045445102466621806889,
                    0.2331937645919904799185237,
                    0.1862902109277342514260976,
                    0.1255803694649046246346943,
                    0.0556685671161736664827537,
                ])
        },
        {
            13, new Point(
                13,
                [
                    0.0000000000000000000000000,
                    0.2304583159551347940655281,
                    0.4484927510364468528779129,
                    0.6423493394403402206439846,
                    0.8015780907333099127942065,
                    0.9175983992229779652065478,
                    0.9841830547185881494728294,
                ],
                [
                    0.2325515532308739101945895,
                    0.2262831802628972384120902,
                    0.2078160475368885023125232,
                    0.1781459807619457382800467,
                    0.1388735102197872384636018,
                    0.0921214998377284479144218,
                    0.0404840047653158795200216,
                ])
        },
        {
            15, new Point(
                15,
                [
                    0.0000000000000000000000000,
                    0.2011940939974345223006283,
                    0.3941513470775633698972074,
                    0.5709721726085388475372267,
                    0.7244177313601700474161861,
                    0.8482065834104272162006483,
                    0.9372733924007059043077589,
                    0.9879925180204854284895657,
                ],
                [
                    0.2025782419255612728806202,
                    0.1984314853271115764561183,
                    0.1861610000155622110268006,
                    0.1662692058169939335532009,
                    0.1395706779261543144478048,
                    0.1071592204671719350118695,
                    0.0703660474881081247092674,
                    0.0307532419961172683546284,
                ])
        },
        {
            17, new Point(
                17,
                [
                    0.0000000000000000000000000,
                    0.1784841814958478558506775,
                    0.3512317634538763152971855,
                    0.5126905370864769678862466,
                    0.6576711592166907658503022,
                    0.7815140038968014069252301,
                    0.8802391537269859021229557,
                    0.9506755217687677612227170,
                    0.9905754753144173356754340,
                ],
                [
                    0.1794464703562065254582656,
                    0.1765627053669926463252710,
                    0.1680041021564500445099707,
                    0.1540457610768102880814316,
                    0.1351363684685254732863200,
                    0.1118838471934039710947884,
                    0.0850361483171791808835354,
                    0.0554595293739872011294402,
                    0.0241483028685479319601100,
                ])
        },
        {
            19, new Point(
                19,
                [
                    0.0000000000000000000000000,
                    0.1603586456402253758680961,
                    0.3165640999636298319901173,
                    0.4645707413759609457172671,
                    0.6005453046616810234696382,
                    0.7209661773352293786170959,
                    0.8227146565371428249789225,
                    0.9031559036148179016426609,
                    0.9602081521348300308527788,
                    0.9924068438435844031890177,
                ],
                [
                    0.1610544498487836959791636,
                    0.1589688433939543476499564,
                    0.1527660420658596667788554,
                    0.1426067021736066117757461,
                    0.1287539625393362276755158,
                    0.1115666455473339947160239,
                    0.0914900216224499994644621,
                    0.0690445427376412265807083,
                    0.0448142267656996003328382,
                    0.0194617882297264770363120,
                ])
        },
    }.ToFrozenDictionary();

    private static readonly double[] s_legendreLookupTable =
    [
        0.000000000000000,
        0.000000000000000,
        0.500000000000000,
        0.666666666666667,
        0.750000000000000,
        0.800000000000000,
        0.833333333333333,
        0.857142857142857,
        0.875000000000000,
        0.888888888888889,
        0.900000000000000,
        0.909090909090909,
        0.916666666666667,
        0.923076923076923,
        0.928571428571429,
        0.933333333333333,
        0.937500000000000,
        0.941176470588235,
        0.944444444444444,
        0.947368421052632,
        0.950000000000000,
        0.952380952380952,
        0.954545454545455,
        0.956521739130435,
        0.958333333333333,
        0.960000000000000,
        0.961538461538462,
        0.962962962962963,
        0.964285714285714,
        0.965517241379310,
        0.966666666666667,
        0.967741935483871,
        0.968750000000000,
        0.969696969696970,
        0.970588235294118,
        0.971428571428571,
        0.972222222222222,
        0.972972972972973,
        0.973684210526316,
        0.974358974358974,
        0.975000000000000,
        0.975609756097561,
        0.976190476190476,
        0.976744186046512,
        0.977272727272727,
        0.977777777777778,
        0.978260869565217,
        0.978723404255319,
        0.979166666666667,
        0.979591836734694,
        0.980000000000000,
        0.980392156862745,
        0.980769230769231,
        0.981132075471698,
        0.981481481481482,
        0.981818181818182,
        0.982142857142857,
        0.982456140350877,
        0.982758620689655,
        0.983050847457627,
        0.983333333333333,
        0.983606557377049,
        0.983870967741935,
        0.984126984126984,
        0.984375000000000,
        0.984615384615385,
        0.984848484848485,
        0.985074626865672,
        0.985294117647059,
        0.985507246376812,
        0.985714285714286,
        0.985915492957746,
        0.986111111111111,
        0.986301369863014,
        0.986486486486487,
        0.986666666666667,
        0.986842105263158,
        0.987012987012987,
        0.987179487179487,
        0.987341772151899,
        0.987500000000000,
        0.987654320987654,
        0.987804878048780,
        0.987951807228916,
        0.988095238095238,
        0.988235294117647,
        0.988372093023256,
        0.988505747126437,
        0.988636363636364,
        0.988764044943820,
        0.988888888888889,
        0.989010989010989,
        0.989130434782609,
        0.989247311827957,
        0.989361702127660,
        0.989473684210526,
        0.989583333333333,
        0.989690721649485,
        0.989795918367347,
        0.989898989898990,
        0.990000000000000,
        0.990099009900990,
        0.990196078431373,
        0.990291262135922,
        0.990384615384615,
        0.990476190476191,
        0.990566037735849,
        0.990654205607477,
        0.990740740740741,
        0.990825688073395,
        0.990909090909091,
        0.990990990990991,
        0.991071428571429,
        0.991150442477876,
        0.991228070175439,
        0.991304347826087,
        0.991379310344828,
        0.991452991452991,
        0.991525423728814,
        0.991596638655462,
        0.991666666666667,
        0.991735537190083,
        0.991803278688525,
        0.991869918699187,
        0.991935483870968,
        0.992000000000000,
        0.992063492063492,
        0.992125984251969,
        0.992187500000000,
    ];

    [ThreadStatic]
    private static Point? s_cachedPoint;

    /// <summary>
    ///     Approximates the definite integral of a function over a finite interval.
    /// </summary>
    /// <param name="f">The function to integrate.</param>
    /// <param name="intervalBegin">The start of the integration interval.</param>
    /// <param name="intervalEnd">The end of the integration interval.</param>
    /// <param name="order">The quadrature order (number of evaluation points).</param>
    /// <returns>The approximate integral value.</returns>
    public static double Integrate(Func<double, double> f, double intervalBegin, double intervalEnd, int order)
    {
        Point point = GetPoint(order);

        int m = (order + 1) >> 1;
        double a = 0.5 * (intervalEnd - intervalBegin);
        double b = 0.5 * (intervalEnd + intervalBegin);

        double[] weights = point.Weights;
        double[] abscissas = point.Abscissas;

        double sum;
        if ((order & 1) != 0)
        {
            sum = weights[0] * f(b);
            for (int i = 1; i < m; i++)
            {
                double ax = a * abscissas[i];
                sum += weights[i] * (f(b + ax) + f(b - ax));
            }
        }
        else
        {
            sum = 0.0;
            for (int i = 0; i < m; i++)
            {
                double ax = a * abscissas[i];
                sum += weights[i] * (f(b + ax) + f(b - ax));
            }
        }

        return a * sum;
    }

    private static Point GetPoint(int order)
    {
        bool isCached = s_cachedPoint is { } cachedPoint && cachedPoint.Order == order;
        if (!isCached)
        {
            if (!s_precomputedPoints.TryGetValue(order, out Point? point))
            {
                point = GeneratePoint(order, 1e-10);
            }

            s_cachedPoint = point;
        }

        return s_cachedPoint!;
    }

    private static Point GeneratePoint(int order, double eps)
    {
        const double pi = 3.1415926535897932384626433832795028841971693993751;

        double w0 = 0;
        int m = (order + 1) >> 1;
        double[] abscissas = new double[m];
        double[] weights = new double[m];
        double t0 = 1.0 - (1.0 - 1.0 / order) / (8.0 * order * order);
        double t1 = 1.0 / (4.0 * order + 2.0);

        for (int i = 1; i <= m; i++)
        {
            int j = 0;
            double x0 = Math.Cos(pi * ((i << 2) - 1) * t1) * t0;
            double x1;
            double dx;
            double w1;
            double dw;

            do
            {
                double p1 = 1.0;
                double p0 = x0;
                double p2;
                int k;
                double t2;

                if (order < s_legendreLookupTable.Length)
                {
                    for (k = 2; k <= order; k++)
                    {
                        p2 = p1;
                        p1 = p0;
                        t2 = x0 * p1;

                        p0 = t2 + s_legendreLookupTable[k] * (t2 - p2);
                    }
                }
                else
                {
                    for (k = 2; k < s_legendreLookupTable.Length; k++)
                    {
                        p2 = p1;
                        p1 = p0;
                        t2 = x0 * p1;

                        p0 = t2 + s_legendreLookupTable[k] * (t2 - p2);
                    }

                    for (k = s_legendreLookupTable.Length; k <= order; k++)
                    {
                        p2 = p1;
                        p1 = p0;
                        t2 = x0 * p1;
                        double t3 = (k - 1.0) / k;

                        p0 = t2 + t3 * (t2 - p2);
                    }
                }

                double dpdx = (x0 * p0 - p1) * order / (x0 * x0 - 1.0);

                x1 = x0 - p0 / dpdx;
                w1 = 2.0 / ((1.0 - x1 * x1) * dpdx * dpdx);

                if (j == 0)
                {
                    w0 = 2.0 / ((1.0 - x0 * x0) * dpdx * dpdx);
                }

                dx = x0 - x1;
                dw = w0 - w1;

                x0 = x1;
                w0 = w1;
                j++;
            }
            while ((Math.Abs(dx) > eps || Math.Abs(dw) > eps) && j < 100);

            int index = m - 1 - (i - 1);

            abscissas[index] = x1;
            weights[index] = w1;
        }

        return new Point(order, abscissas, weights);
    }

    private sealed record Point(int Order, double[] Abscissas, double[] Weights);
}
